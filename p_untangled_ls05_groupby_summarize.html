<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Grouping and summarizing data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="p_untangled_ls05_groupby_summarize_files/libs/clipboard/clipboard.min.js"></script>
<script src="p_untangled_ls05_groupby_summarize_files/libs/quarto-html/quarto.js"></script>
<script src="p_untangled_ls05_groupby_summarize_files/libs/quarto-html/popper.min.js"></script>
<script src="p_untangled_ls05_groupby_summarize_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="p_untangled_ls05_groupby_summarize_files/libs/quarto-html/anchor.min.js"></script>
<link href="p_untangled_ls05_groupby_summarize_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="p_untangled_ls05_groupby_summarize_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="p_untangled_ls05_groupby_summarize_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="p_untangled_ls05_groupby_summarize_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="p_untangled_ls05_groupby_summarize_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Grouping and summarizing data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>You’ve now mastered filtering data, selecting variables, and modifying columns.</p>
<p>In this lesson, we’ll explore two powerful pandas methods: <code>agg()</code> and <code>groupby()</code>. These tools will enable you to extract summary statistics and perform operations on grouped data effortlessly.</p>
<p>Let’s dive in and discover how to unlock deeper insights from your data!</p>
</section>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning objectives</h2>
<ol type="1">
<li><p>You can use <code>pandas.DataFrame.agg()</code> to extract summary statistics from datasets.</p></li>
<li><p>You can use <code>pandas.DataFrame.groupby()</code> to group data by one or more variables before performing operations on them.</p></li>
<li><p>You understand why and how to ungroup grouped data frames.</p></li>
<li><p>You can use <code>pandas.DataFrame.groupby().size()</code> to count rows per group.</p></li>
<li><p>You can use <code>sum()</code> together with <code>groupby()</code>-<code>agg()</code> to count rows that meet a condition.</p></li>
<li><p>You can use <code>pandas.DataFrame.value_counts()</code> as a handy function to count rows per group.</p></li>
</ol>
<hr>
</section>
<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<p>Run the following line to import the necessary libraries:</p>
<div id="4cddf0e2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-yaounde-covid-19-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-yaounde-covid-19-dataset">The Yaounde COVID-19 dataset</h2>
<p>In this lesson, we will again use data from the COVID-19 serological survey conducted in Yaounde, Cameroon.</p>
<div id="4cc6fdec" class="cell" data-message="false" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>yaounde <span class="op">=</span> pd.read_csv(<span class="st">'data/yaounde_data.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">## A smaller subset of variables</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>yao <span class="op">=</span> yaounde[[<span class="st">'age'</span>, <span class="st">'age_category_3'</span>, <span class="st">'sex'</span>, <span class="st">'weight_kg'</span>, <span class="st">'height_cm'</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">'neighborhood'</span>, <span class="st">'is_smoker'</span>, <span class="st">'is_pregnant'</span>, <span class="st">'occupation'</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">'treatment_combinations'</span>, <span class="st">'symptoms'</span>, <span class="st">'n_days_miss_work'</span>, <span class="st">'n_bedridden_days'</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">'highest_education'</span>, <span class="st">'igg_result'</span>]]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>yao</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
<th data-quarto-table-cell-role="th">age_category_3</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">weight_kg</th>
<th data-quarto-table-cell-role="th">height_cm</th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">is_smoker</th>
<th data-quarto-table-cell-role="th">is_pregnant</th>
<th data-quarto-table-cell-role="th">occupation</th>
<th data-quarto-table-cell-role="th">treatment_combinations</th>
<th data-quarto-table-cell-role="th">symptoms</th>
<th data-quarto-table-cell-role="th">n_days_miss_work</th>
<th data-quarto-table-cell-role="th">n_bedridden_days</th>
<th data-quarto-table-cell-role="th">highest_education</th>
<th data-quarto-table-cell-role="th">igg_result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>45</td>
<td>Adult</td>
<td>Female</td>
<td>95</td>
<td>169</td>
<td>Briqueterie</td>
<td>Non-smoker</td>
<td>No</td>
<td>Informal worker</td>
<td>Paracetamol</td>
<td>Muscle pain</td>
<td>0.0</td>
<td>0.0</td>
<td>Secondary</td>
<td>Negative</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>55</td>
<td>Adult</td>
<td>Male</td>
<td>96</td>
<td>185</td>
<td>Briqueterie</td>
<td>Ex-smoker</td>
<td>NaN</td>
<td>Salaried worker</td>
<td>NaN</td>
<td>No symptoms</td>
<td>NaN</td>
<td>NaN</td>
<td>University</td>
<td>Positive</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>23</td>
<td>Adult</td>
<td>Male</td>
<td>74</td>
<td>180</td>
<td>Briqueterie</td>
<td>Smoker</td>
<td>NaN</td>
<td>Student</td>
<td>NaN</td>
<td>No symptoms</td>
<td>NaN</td>
<td>NaN</td>
<td>University</td>
<td>Negative</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">968</td>
<td>35</td>
<td>Adult</td>
<td>Male</td>
<td>77</td>
<td>168</td>
<td>Tsinga Oliga</td>
<td>Smoker</td>
<td>NaN</td>
<td>Informal worker</td>
<td>Paracetamol</td>
<td>Headache</td>
<td>0.0</td>
<td>0.0</td>
<td>University</td>
<td>Positive</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">969</td>
<td>31</td>
<td>Adult</td>
<td>Female</td>
<td>66</td>
<td>169</td>
<td>Tsinga Oliga</td>
<td>Non-smoker</td>
<td>No</td>
<td>Unemployed</td>
<td>NaN</td>
<td>No symptoms</td>
<td>NaN</td>
<td>NaN</td>
<td>Secondary</td>
<td>Negative</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">970</td>
<td>17</td>
<td>Child</td>
<td>Female</td>
<td>67</td>
<td>162</td>
<td>Tsinga Oliga</td>
<td>Non-smoker</td>
<td>No response</td>
<td>Unemployed</td>
<td>NaN</td>
<td>No symptoms</td>
<td>NaN</td>
<td>NaN</td>
<td>Secondary</td>
<td>Negative</td>
</tr>
</tbody>
</table>

<p>971 rows × 15 columns</p>
</div>
</div>
</div>
<p>See the first lesson in this chapter for more information about this dataset.</p>
</section>
<section id="what-are-summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="what-are-summary-statistics">What are summary statistics?</h2>
<p>A summary statistic is a single value (such as a mean or median) that describes a sequence of values (typically a column in your dataset). Summary statistics can describe the center, spread or range of a variable, or the counts and positions of values within that variable.</p>
<p>Computing summary statistics is a very common operation in most data analysis workflows, so it will be important to become fluent in extracting them from your datasets. And for this task, there is no better tool than the pandas method <code>agg()</code>! So let’s see how to use this powerful method.</p>
</section>
<section id="introducing-pandas.dataframe.agg" class="level2">
<h2 class="anchored" data-anchor-id="introducing-pandas.dataframe.agg">Introducing <code>pandas.DataFrame.agg()</code></h2>
<p>To get started, let’s consider how to get simple summary statistics <em>without</em> using <code>agg()</code>, then we will consider why you <em>should</em> actually use <code>agg()</code>.</p>
<p>Imagine you were asked to find the mean age of respondents in the <code>yao</code> data frame. How might you do this in base Python?</p>
<p>First, recall that square bracket notation allows you to extract a column from a data frame:</p>
<div id="cf57a7b6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>yao[[<span class="st">"age"</span>]]  <span class="co"># extract the `age` column from `yao`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To obtain the mean, you simply call the <code>mean()</code> method on this <code>yao['age']</code> Series:</p>
<div id="67e009c5" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>yao[[<span class="st">"age"</span>]].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>age    29.017508
dtype: float64</code></pre>
</div>
</div>
<p>And that’s it! You now have a simple summary statistic. Extremely easy, right?</p>
<p>So why do we need <code>agg()</code> to get summary statistics if the process is already so simple without it? We’ll come back to the <em>why</em> question soon. First let’s see <em>how</em> to obtain summary statistics with <code>agg()</code>.</p>
<p>Going back to the previous example, the correct syntax to get the mean age with <code>agg()</code> would be:</p>
<div id="cd370f93" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>yao.agg(mean_age<span class="op">=</span>(<span class="st">'age'</span>, <span class="st">'mean'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">mean_age</td>
<td>29.017508</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The anatomy of this syntax is quite simple. You simply need to the name of the new column (e.g.&nbsp;<code>mean_age</code>), the column to summarize (e.g.&nbsp;<code>age</code>), and the summary function (e.g.&nbsp;<code>'mean'</code>).</p>
<hr>
<p>You can also compute multiple summary statistics in a single <code>agg()</code> statement. For example, if you wanted both the mean and the median age, you could run:</p>
<div id="0c8f0257" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>yao.agg(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    mean_age<span class="op">=</span>(<span class="st">'age'</span>, <span class="st">'mean'</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    median_age<span class="op">=</span>(<span class="st">'age'</span>, <span class="st">'median'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">mean_age</td>
<td>29.017508</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">median_age</td>
<td>26.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Nice! Try your hand at the practice question below.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>agg()</code> and the relevant summary functions to obtain the mean and median of respondent weights from the <code>weight_kg</code> variable of the <code>yao</code> data frame.</p>
<div id="00f77164" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>agg()</code> and the relevant summary functions to obtain the minimum and maximum respondent heights from the <code>height_cm</code> variable of the <code>yao</code> data frame. You may need to use a search engine to find out the minimum and maximum functions in Python if you don’t remember them.</p>
<div id="75ccbf36" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="grouped-summaries-with-pandas.dataframe.groupby" class="level2">
<h2 class="anchored" data-anchor-id="grouped-summaries-with-pandas.dataframe.groupby">Grouped summaries with <code>pandas.DataFrame.groupby()</code></h2>
<p>Now let’s see how to use <code>groupby()</code> to obtain grouped summaries, the primary reason for using <code>agg()</code> in the first place.</p>
<p>As its name suggests, <code>pandas.DataFrame.groupby()</code> lets you group a data frame by the values in a variable (e.g.&nbsp;male vs female sex). You can then perform operations that are split according to these groups.</p>
<p>What effect does <code>groupby()</code> have on a data frame? Let’s try to group the <code>yao</code> data frame by sex and observe the effect:</p>
<div id="b7207e52" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>yao.groupby(<span class="st">'sex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x112742780&gt;</code></pre>
</div>
</div>
<p>Hmm. Apparently nothing happened. We just get a <code>GroupBy</code> object.</p>
<p>But watch what happens when we chain the <code>groupby()</code> with the <code>agg()</code> call we used in the previous section:</p>
<div id="c07d66f8" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    yao</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'sex'</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    .agg(mean_age<span class="op">=</span>(<span class="st">'age'</span>, <span class="st">'mean'</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Female</td>
<td>29.495446</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Male</td>
<td>28.395735</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now we get a different statistic for each group! The mean age for female respondents is about 29.5, while for male respondents it’s about 28.4.</p>
<p>As was mentioned earlier, this kind of grouped summary is the primary reason the <code>agg()</code> function is so useful.</p>
<p>You may notice that there are two headers. This is because the output has a hierarchical index (MultiIndex). While this can be useful in some cases, it often makes further data manipulation more difficult. We can reset the index to convert the group labels back to a regular column with the <code>reset_index()</code> method.</p>
<div id="cb02cc65" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>yao.groupby(<span class="st">"sex"</span>).agg(mean_age<span class="op">=</span>(<span class="st">"age"</span>, <span class="st">"mean"</span>)).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Female</td>
<td>29.495446</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Male</td>
<td>28.395735</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<hr>
<p>Let’s see some more examples.</p>
<p>Suppose you were asked to obtain the maximum and minimum weights for individuals in different neighborhoods, and also present the number of individuals in each neighborhood. We can write:</p>
<div id="81429d1c" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    yao.groupby(<span class="st">"neighborhood"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        max_weight<span class="op">=</span>(<span class="st">"weight_kg"</span>, <span class="st">"max"</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        min_weight<span class="op">=</span>(<span class="st">"weight_kg"</span>, <span class="st">"min"</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        count<span class="op">=</span>(<span class="st">"neighborhood"</span>, <span class="st">"size"</span>),  <span class="co"># the size function counts rows per group</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">max_weight</th>
<th data-quarto-table-cell-role="th">min_weight</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Briqueterie</td>
<td>128</td>
<td>20</td>
<td>106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Carriere</td>
<td>129</td>
<td>14</td>
<td>236</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cité Verte</td>
<td>118</td>
<td>16</td>
<td>72</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Nkomkana</td>
<td>161</td>
<td>15</td>
<td>75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Tsinga</td>
<td>105</td>
<td>15</td>
<td>81</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Tsinga Oliga</td>
<td>100</td>
<td>17</td>
<td>67</td>
</tr>
</tbody>
</table>

<p>9 rows × 4 columns</p>
</div>
</div>
</div>
<p>Great! With just a few code lines you are able to extract quite a lot of information.</p>
<hr>
<p>Let’s see one more example for good measure. The variable <code>n_days_miss_work</code> tells us the number of days that respondents missed work due to COVID-like symptoms. Individuals who reported no COVID-like symptoms have an <code>NA</code> for this variable:</p>
<div id="56b5e780" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>yao[[<span class="st">'n_days_miss_work'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">n_days_miss_work</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">968</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">969</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">970</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>971 rows × 1 columns</p>
</div>
</div>
</div>
<p>To count the total number of work days missed for each sex group, we can write:</p>
<div id="6002c751" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    yao</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'sex'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .agg(total_days_missed<span class="op">=</span>(<span class="st">'n_days_miss_work'</span>, <span class="st">'sum'</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">total_days_missed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Female</td>
<td>256.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Male</td>
<td>272.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The output tells us that across all women in the sample, 256 work days were missed due to COVID-like symptoms, and across all men, 272 days.</p>
<hr>
<p>So hopefully now you see why <code>agg()</code> is so powerful. In combination with <code>groupby()</code>, it lets you obtain highly informative grouped summaries of your datasets with very few lines of code.</p>
<p>Producing such summaries is a very important part of most data analysis workflows, so this skill is likely to come in handy soon!</p>
<div class="callout callout-style-default callout-note callout-titled" title="Vocab">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Vocab
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong><code>agg()</code> produces “Pivot Tables</strong>”</p>
<p>The summary data frames created by <code>agg()</code> are often called Pivot Tables in the context of spreadsheet software like Microsoft Excel.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>groupby()</code>, <code>agg()</code>, and the relevant summary functions to obtain the minimum and maximum heights for each sex in the <code>yao</code> data frame, as well as the number of individuals in each sex group.</p>
<p>Your output should be a DataFrame that looks like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>sex</th>
<th>min_height_cm</th>
<th>max_height_cm</th>
<th>count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Female</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Male</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div id="1dc76a55" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Pro-tip">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pro-tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Groupby and agg are not always needed</strong></p>
<p>Sometimes you just want a quick summary of a variable, not per group. In this case, you can use the <code>describe()</code> method to get a quick summary of a variable.</p>
<p>Remember that there are quick ways to get such statistics:</p>
<div id="80b2f5f8" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>yao[<span class="st">'age'</span>].describe() <span class="co"># summary stats for a numeric variable</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>yao[<span class="st">'sex'</span>].describe() <span class="co"># summary stats for a categorical variable</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>yao[<span class="st">'sex'</span>].value_counts() <span class="co"># count of each category</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>sex
Female    549
Male      422
Name: count, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Watch-out">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Watch-out
</div>
</div>
<section id="nan-values-in-agg" class="level2 callout-body-container callout-body">
<h2 class="anchored" data-anchor-id="nan-values-in-agg">NaN values in <code>agg()</code></h2>
<p>You can use the <code>dropna</code> parameter in <code>agg()</code> to control whether to drop NaN values. For example, the smoking status variable in the <code>yao</code> data frame contains NaN values. If we try to compute the mean weight for smokers, we can either include or exclude the NaN individuals in the summary table.</p>
<p>By default, <code>dropna=True</code> and individuals with NaN values for the <code>is_smoker</code> variable are dropped from the summary table.</p>
<div id="f5128eba" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>yao.groupby(<span class="st">"is_smoker"</span>).agg(weight_mean<span class="op">=</span>(<span class="st">"weight_kg"</span>, <span class="st">"mean"</span>)).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">is_smoker</th>
<th data-quarto-table-cell-role="th">weight_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Ex-smoker</td>
<td>76.366197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Non-smoker</td>
<td>63.033760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Smoker</td>
<td>72.410256</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>But we can include these individuals in the summary table by setting <code>dropna=False</code>:</p>
<div id="61173b42" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    yao.groupby(<span class="st">"is_smoker"</span>, dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    .agg(weight_mean<span class="op">=</span>(<span class="st">"weight_kg"</span>, <span class="st">"mean"</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">is_smoker</th>
<th data-quarto-table-cell-role="th">weight_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Ex-smoker</td>
<td>76.366197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Non-smoker</td>
<td>63.033760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Smoker</td>
<td>72.410256</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NaN</td>
<td>73.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>groupby()</code>, <code>agg()</code>, and the <code>mean()</code> function to obtain the mean weight (kg) by pregnancy status in the <code>yao</code> data frame. Be sure to include individuals with NaN pregnancy status in the summary table. Name the average weight column <code>weight_mean</code>. Store the output in a variable named <code>Q_weight_by_pregnancy_status</code>.</p>
<p>The output data frame should look like something like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>is_pregnant</th>
<th>weight_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>No</td>
<td></td>
</tr>
<tr class="even">
<td>No response</td>
<td></td>
</tr>
<tr class="odd">
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>NA</td>
<td></td>
</tr>
</tbody>
</table>
<div id="2ac73ecb" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="grouping-by-multiple-variables-nested-grouping" class="level2">
<h2 class="anchored" data-anchor-id="grouping-by-multiple-variables-nested-grouping">Grouping by multiple variables (nested grouping)</h2>
<p>It is possible to group a data frame by more than one variable. This is sometimes called “nested” grouping.</p>
<p>Let’s see an example. Suppose you want to know the mean age of men and women <em>in each neighbourhood</em> (rather than the mean age of <em>all</em> women), you could put both <code>sex</code> and <code>neighborhood</code> in the <code>groupby()</code> statement:</p>
<div id="8027c129" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    yao</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'sex'</span>, <span class="st">'neighborhood'</span>])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    .agg(mean_age<span class="op">=</span>(<span class="st">'age'</span>, <span class="st">'mean'</span>))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Female</td>
<td>Briqueterie</td>
<td>31.622951</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Female</td>
<td>Carriere</td>
<td>28.164286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Female</td>
<td>Cité Verte</td>
<td>31.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>Male</td>
<td>Nkomkana</td>
<td>29.812500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>Male</td>
<td>Tsinga</td>
<td>28.820513</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>Male</td>
<td>Tsinga Oliga</td>
<td>24.297297</td>
</tr>
</tbody>
</table>

<p>18 rows × 3 columns</p>
</div>
</div>
</div>
<p>From this output data frame you can tell that, for example, women from Briqueterie have a mean age of 31.6 years, while men from Briqueterie have a mean age of 33.7 years.</p>
<p>The order of the columns listed in <code>groupby()</code> is interchangeable. So if you run <code>groupby(['neighborhood', 'sex'])</code> instead of <code>groupby(['sex', 'neighborhood'])</code>, you’ll get the same result, although it will be ordered differently:</p>
<div id="eac4dd7b" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    yao</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'neighborhood'</span>, <span class="st">'sex'</span>])</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    .agg(mean_age<span class="op">=</span>(<span class="st">'age'</span>, <span class="st">'mean'</span>))</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">sex</th>
<th data-quarto-table-cell-role="th">mean_age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Briqueterie</td>
<td>Female</td>
<td>31.622951</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Briqueterie</td>
<td>Male</td>
<td>33.711111</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Carriere</td>
<td>Female</td>
<td>28.164286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>Tsinga</td>
<td>Male</td>
<td>28.820513</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>Tsinga Oliga</td>
<td>Female</td>
<td>24.266667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>Tsinga Oliga</td>
<td>Male</td>
<td>24.297297</td>
</tr>
</tbody>
</table>

<p>18 rows × 3 columns</p>
</div>
</div>
</div>
<p>Now the column order is different: <code>neighborhood</code> is the first column, and <code>sex</code> is the second. And the row order is also different: rows are first ordered by <code>neighborhood</code>, then ordered by <code>sex</code> within each neighborhood.</p>
<p>But the actual summary statistics are the same. For example, you can again see that women from Briqueterie have a mean age of 31.6 years, while men from Briqueterie have a mean age of 33.7 years.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>groupby()</code>, <code>agg()</code>, and the <code>sum()</code> function to calculate the total number of bedridden days (from the <code>n_bedridden_days</code> variable) reported by respondents of each age-sex group. For age group, use the <code>age_category_3</code> variable.</p>
<p>Your output should be a data frame with three columns named as shown below:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>age_category_3</th>
<th>sex</th>
<th>total_bedridden_days</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Adult</td>
<td>Female</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Male</td>
<td></td>
</tr>
<tr class="odd">
<td>Child</td>
<td>Female</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Male</td>
<td></td>
</tr>
<tr class="odd">
<td>Senior</td>
<td>Female</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Male</td>
<td></td>
</tr>
</tbody>
</table>
<div id="cc5396a1" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>I’d be happy to help you write the last two sections. Here’s how we can complete them:</p>
</section>
<section id="custom-summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="custom-summary-statistics">Custom summary statistics</h2>
<p>Sometimes, you may want to apply custom summary statistics that aren’t available as built-in functions. In these cases, you can use lambda functions or define your own functions to use with <code>agg()</code>.</p>
<p>For example, let’s say we want to calculate the range (difference between maximum and minimum) of weights in each neighborhood:</p>
<div id="7022b21d" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    yao</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'neighborhood'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    .agg(weight_range<span class="op">=</span>(<span class="st">'weight_kg'</span>, <span class="kw">lambda</span> x: x.<span class="bu">max</span>() <span class="op">-</span> x.<span class="bu">min</span>()))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">weight_range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Briqueterie</td>
<td>108</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Carriere</td>
<td>115</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cité Verte</td>
<td>102</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Nkomkana</td>
<td>146</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Tsinga</td>
<td>90</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Tsinga Oliga</td>
<td>83</td>
</tr>
</tbody>
</table>

<p>9 rows × 2 columns</p>
</div>
</div>
</div>
<p>Notice that we still provide a tuple to the <code>agg()</code> function, <code>('weight_kg', lambda x: x.max() - x.min())</code>, but the second element of the tuple is a lambda function.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Find the interquartile range (IQR) of the age variable for each neighborhood. The IQR is the difference between the 75th and 25th percentiles. Your lambda will look like this: <code>lambda x: x.quantile(0.75) - x.quantile(0.25)</code></p>
<div id="81bf2acc" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="counting-rows-that-meet-a-condition" class="level3">
<h3 class="anchored" data-anchor-id="counting-rows-that-meet-a-condition">Counting rows that meet a condition</h3>
<p>It is sometimes useful to count the rows that meet specific conditions within a group. This can be done with the groupby and agg functions.</p>
<p>For example, to count the number of people under 18 in each neighborhood, we can write:</p>
<div id="fe053179" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    yao</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'neighborhood'</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    .agg(num_children<span class="op">=</span>(<span class="st">'age'</span>, <span class="kw">lambda</span> x: (x <span class="op">&lt;</span> <span class="dv">18</span>).<span class="bu">sum</span>()))</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">num_children</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Briqueterie</td>
<td>28</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Carriere</td>
<td>58</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cité Verte</td>
<td>19</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Nkomkana</td>
<td>22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Tsinga</td>
<td>23</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Tsinga Oliga</td>
<td>25</td>
</tr>
</tbody>
</table>

<p>9 rows × 2 columns</p>
</div>
</div>
</div>
<p>Let’s add the number of seniors (65+) too, and we’ll also calculate the percentage of children and seniors in each neighborhood:</p>
<div id="a67cce90" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    yao.groupby(<span class="st">"neighborhood"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        num_children<span class="op">=</span>(<span class="st">"age"</span>, <span class="kw">lambda</span> x: (x <span class="op">&lt;</span> <span class="dv">18</span>).<span class="bu">sum</span>()),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        num_seniors<span class="op">=</span>(<span class="st">"age"</span>, <span class="kw">lambda</span> x: (x <span class="op">&gt;=</span> <span class="dv">65</span>).<span class="bu">sum</span>()),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        children_percent<span class="op">=</span>(<span class="st">"age"</span>, <span class="kw">lambda</span> x: (x <span class="op">&lt;</span> <span class="dv">18</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(x) <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        seniors_percent<span class="op">=</span>(<span class="st">"age"</span>, <span class="kw">lambda</span> x: (x <span class="op">&gt;=</span> <span class="dv">65</span>).<span class="bu">sum</span>() <span class="op">/</span> <span class="bu">len</span>(x) <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">num_children</th>
<th data-quarto-table-cell-role="th">num_seniors</th>
<th data-quarto-table-cell-role="th">children_percent</th>
<th data-quarto-table-cell-role="th">seniors_percent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Briqueterie</td>
<td>28</td>
<td>9</td>
<td>26.415094</td>
<td>8.490566</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Carriere</td>
<td>58</td>
<td>9</td>
<td>24.576271</td>
<td>3.813559</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cité Verte</td>
<td>19</td>
<td>4</td>
<td>26.388889</td>
<td>5.555556</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Nkomkana</td>
<td>22</td>
<td>6</td>
<td>29.333333</td>
<td>8.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Tsinga</td>
<td>23</td>
<td>5</td>
<td>28.395062</td>
<td>6.172840</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Tsinga Oliga</td>
<td>25</td>
<td>0</td>
<td>37.313433</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

<p>9 rows × 5 columns</p>
</div>
</div>
</div>
<p><code>(x &lt; 18).sum()</code> counts the number of individuals in the <code>x</code> series who are under 18 years old, then we divide by the total number of individuals in the series <code>len(x)</code> and multiply by 100 to get the percentage of children in each neighborhood. And likewise for seniors.</p>
<hr>
<p>As a final example, to count the number of people with doctorate degrees in each neighborhood, we can write:</p>
<div id="4ddf465e" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    yao</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'neighborhood'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    .agg(count_with_doctorates<span class="op">=</span>(<span class="st">'highest_education'</span>, <span class="kw">lambda</span> x: (x <span class="op">==</span> <span class="st">"Doctorate"</span>).<span class="bu">sum</span>()))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">neighborhood</th>
<th data-quarto-table-cell-role="th">count_with_doctorates</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Briqueterie</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Carriere</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Cité Verte</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Nkomkana</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Tsinga</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Tsinga Oliga</td>
<td>3</td>
</tr>
</tbody>
</table>

<p>9 rows × 2 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<div class="callout-body-container callout-body">
<p>Calculate the percentage of people with are smokers (use the <code>is_smoker</code> variable) for each combination of sex and age category (use <code>age_category_3</code>). The output should look like this:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>sex</th>
<th>age_category_3</th>
<th>smoker_rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Female</td>
<td>Adult</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Child</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>Senior</td>
<td></td>
</tr>
<tr class="even">
<td>Male</td>
<td>Adult</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>Child</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>Senior</td>
<td></td>
</tr>
</tbody>
</table>
<p>Your summary table should show that male adults have the highest smoker rate, followed by male seniors.</p>
<div id="27b59d16" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="wrap-up" class="level2">
<h2 class="anchored" data-anchor-id="wrap-up">Wrap up</h2>
<p>In this lesson, you’ve learned how to:</p>
<ol type="1">
<li>Obtain quick summary statistics from your data using <code>agg()</code>.</li>
<li>Group your data using <code>groupby()</code>.</li>
<li>Combine <code>groupby()</code> with <code>agg()</code> for powerful data summarization.</li>
</ol>
<p>These skills are essential for both exploratory data analysis and preparing data for presentation or plotting. The combination of <code>groupby()</code> and <code>agg()</code> is one of the most common and useful data manipulation techniques in pandas.</p>
<p>It turns out that <code>groupby()</code> can be combined with many other pandas methods beyond just <code>agg()</code>. In our next lesson, we’ll explore these additional combinations to further expand your data manipulation toolkit.</p>
<p>See you there!</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>