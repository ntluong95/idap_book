<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>18&nbsp; Grouped Transformations and Filtering – Introduction to Data Science with Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./p_untangled_pivoting.html" rel="next">
<link href="./p_untangled_groupby_agg.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p_untangled_subset_columns.html">Data Manipulation</a></li><li class="breadcrumb-item"><a href="./p_untangled_other_grouped_operations.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Grouped Transformations and Filtering</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Science with Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/the-graph-courses/idap_book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_google_colab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Google Colab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_coding_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coding basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_functions_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Functions, Methods, and Libraries in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Structures in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_for_loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Intro to Loops in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_installing_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Installing Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_using_vscode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Using VS Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_venv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Workspace Folders and Virtual Environments with <code>venv</code> and VS Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Using Quarto</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_data_viz_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualization Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_univariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Univariate Graphs with Plotly Express</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Bivariate &amp; Multivariate Graphs with Plotly Express</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Manipulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_subset_columns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Subsetting columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_query_rows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Subsetting rows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_assign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Creating and modifying variables with <code>assign()</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_case_when.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Conditional assignment with case_when() and np.where()</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_groupby_agg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Grouping and summarizing data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_other_grouped_operations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Grouped Transformations and Filtering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_pivoting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Reshaping data</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction-to-grouped-operations" id="toc-introduction-to-grouped-operations" class="nav-link active" data-scroll-target="#introduction-to-grouped-operations"><span class="header-section-number">18.1</span> Introduction to Grouped Operations</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">18.2</span> Learning Objectives</a></li>
  <li><a href="#required-packages" id="toc-required-packages" class="nav-link" data-scroll-target="#required-packages"><span class="header-section-number">18.3</span> Required Packages</a></li>
  <li><a href="#simple-toy-dataset" id="toc-simple-toy-dataset" class="nav-link" data-scroll-target="#simple-toy-dataset"><span class="header-section-number">18.4</span> Simple Toy Dataset</a>
  <ul class="collapse">
  <li><a href="#regular-assign-call" id="toc-regular-assign-call" class="nav-link" data-scroll-target="#regular-assign-call"><span class="header-section-number">18.4.1</span> Regular <code>assign()</code> Call</a></li>
  <li><a href="#grouped-assign-call" id="toc-grouped-assign-call" class="nav-link" data-scroll-target="#grouped-assign-call"><span class="header-section-number">18.4.2</span> Grouped <code>assign()</code> Call</a></li>
  </ul></li>
  <li><a href="#real-dataset-austin-housing" id="toc-real-dataset-austin-housing" class="nav-link" data-scroll-target="#real-dataset-austin-housing"><span class="header-section-number">18.5</span> Real Dataset: Austin Housing</a>
  <ul class="collapse">
  <li><a href="#regular-assign-call-1" id="toc-regular-assign-call-1" class="nav-link" data-scroll-target="#regular-assign-call-1"><span class="header-section-number">18.5.1</span> Regular <code>assign()</code> Call</a></li>
  <li><a href="#grouped-assign-call-1" id="toc-grouped-assign-call-1" class="nav-link" data-scroll-target="#grouped-assign-call-1"><span class="header-section-number">18.5.2</span> Grouped <code>assign()</code> Call</a></li>
  <li><a href="#more-examples-of-grouped-transformations" id="toc-more-examples-of-grouped-transformations" class="nav-link" data-scroll-target="#more-examples-of-grouped-transformations"><span class="header-section-number">18.5.4</span> More Examples of Grouped Transformations</a></li>
  </ul></li>
  <li><a href="#grouped-filtering-with-query" id="toc-grouped-filtering-with-query" class="nav-link" data-scroll-target="#grouped-filtering-with-query"><span class="header-section-number">18.6</span> Grouped Filtering with <code>query()</code></a>
  <ul class="collapse">
  <li><a href="#filter-for-month-with-highest-sales-volume-per-year" id="toc-filter-for-month-with-highest-sales-volume-per-year" class="nav-link" data-scroll-target="#filter-for-month-with-highest-sales-volume-per-year"><span class="header-section-number">18.6.1</span> Filter for Month with Highest Sales Volume per Year</a></li>
  <li><a href="#month-with-the-most-typical-sales" id="toc-month-with-the-most-typical-sales" class="nav-link" data-scroll-target="#month-with-the-most-typical-sales"><span class="header-section-number">18.6.3</span> Month with the Most “Typical” Sales</a></li>
  </ul></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up"><span class="header-section-number">18.7</span> Wrap Up</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/the-graph-courses/idap_book/edit/main/p_untangled_other_grouped_operations.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/the-graph-courses/idap_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p_untangled_subset_columns.html">Data Manipulation</a></li><li class="breadcrumb-item"><a href="./p_untangled_other_grouped_operations.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Grouped Transformations and Filtering</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Grouped Transformations and Filtering</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-to-grouped-operations" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="introduction-to-grouped-operations"><span class="header-section-number">18.1</span> Introduction to Grouped Operations</h2>
<p>Data wrangling often involves applying the same operations separately to different groups within the data. In this lesson, we’ll learn how to use <code>groupby()</code> with <code>transform()</code> and <code>assign()</code> to conduct grouped transformations on a DataFrame.</p>
</section>
<section id="learning-objectives" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">18.2</span> Learning Objectives</h2>
<ol type="1">
<li>You can use <code>groupby()</code> with <code>transform()</code> and <code>assign()</code> to conduct grouped operations on a DataFrame.</li>
</ol>
</section>
<section id="required-packages" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="required-packages"><span class="header-section-number">18.3</span> Required Packages</h2>
<p>This lesson requires pandas and numpy:</p>
<div id="392b7ca4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-toy-dataset" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="simple-toy-dataset"><span class="header-section-number">18.4</span> Simple Toy Dataset</h2>
<p>Let’s start with a simple toy dataset to illustrate the concepts:</p>
<div id="0044ddc2" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple toy dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>toy_data <span class="op">=</span> pd.DataFrame(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"year"</span>: [<span class="dv">2022</span>, <span class="dv">2022</span>, <span class="dv">2023</span>, <span class="dv">2023</span>],</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">"month"</span>: [<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Jan"</span>, <span class="st">"Feb"</span>],</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"sales"</span>: [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>],</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(toy_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   year month  sales
0  2022   Jan      2
1  2022   Feb      4
2  2023   Jan      6
3  2023   Feb      8</code></pre>
</div>
</div>
<section id="regular-assign-call" class="level3" data-number="18.4.1">
<h3 data-number="18.4.1" class="anchored" data-anchor-id="regular-assign-call"><span class="header-section-number">18.4.1</span> Regular <code>assign()</code> Call</h3>
<p>Let’s add a column with the mean sales for the entire dataset, then calculate the difference between each month’s sales and the mean sales:</p>
<div id="d9e32a27" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>toy_data.assign(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    mean_sales<span class="op">=</span><span class="kw">lambda</span> x: x.sales.mean(), </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    sales_diff<span class="op">=</span><span class="kw">lambda</span> x: x.sales <span class="op">-</span> x.mean_sales</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">mean_sales</th>
<th data-quarto-table-cell-role="th">sales_diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2022</td>
<td>Jan</td>
<td>2</td>
<td>5.0</td>
<td>-3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2022</td>
<td>Feb</td>
<td>4</td>
<td>5.0</td>
<td>-1.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023</td>
<td>Jan</td>
<td>6</td>
<td>5.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023</td>
<td>Feb</td>
<td>8</td>
<td>5.0</td>
<td>3.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In this example, the <code>mean_sales</code> column contains the mean sales value for the entire dataset (5), repeated in each row. The <code>sales_diff</code> column shows the difference between each month’s sales and the overall mean sales.</p>
</section>
<section id="grouped-assign-call" class="level3" data-number="18.4.2">
<h3 data-number="18.4.2" class="anchored" data-anchor-id="grouped-assign-call"><span class="header-section-number">18.4.2</span> Grouped <code>assign()</code> Call</h3>
<p>But we might want to see how each month’s sales compare to the mean sales for that year.</p>
<div id="5acd912a" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>toy_data.assign(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    mean_sales<span class="op">=</span><span class="kw">lambda</span> x: x.groupby(<span class="st">"year"</span>).sales.mean(),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    sales_diff<span class="op">=</span><span class="kw">lambda</span> x: x.sales <span class="op">-</span> x.mean_sales</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">mean_sales</th>
<th data-quarto-table-cell-role="th">sales_diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2022</td>
<td>Jan</td>
<td>2</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2022</td>
<td>Feb</td>
<td>4</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023</td>
<td>Jan</td>
<td>6</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2023</td>
<td>Feb</td>
<td>8</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now we have the mean sales for year 2022 as 3 and for year 2023 as 7. and the sales_diff column shows how far each month’s sales are from the mean sales for that year.</p>
<p>Let’s break down the code, especially the first line:</p>
<ul>
<li>Within the assign method, we initiate the <code>mean_sales</code> column</li>
<li>Then we pass the lambda function to the <code>mean_sales</code> column</li>
<li>The lambda function takes the dataframe, denoted <code>x</code> as input, groups it by <code>year</code> (<code>x.groupby("year")</code>), then pulls out the <code>sales</code> column (<code>x.groupby("year").sales</code>) then to compute the mean for each year, we use the <code>transform()</code> method (<code>x.groupby("year").sales.transform("mean")</code>).</li>
</ul>
</section>
</section>
<section id="real-dataset-austin-housing" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="real-dataset-austin-housing"><span class="header-section-number">18.5</span> Real Dataset: Austin Housing</h2>
<p>Now let’s apply these concepts to a real dataset. We’ll use the <code>housing</code> dataset containing housing sales data for Austin, Texas:</p>
<div id="7d444124" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>housing <span class="op">=</span> pd.read_csv(<span class="st">"data/austinhousing.csv"</span>, usecols<span class="op">=</span>[<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"sales"</span>])</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Display first few rows of the dataset</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>housing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>1</td>
<td>1025</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>2</td>
<td>1277</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>3</td>
<td>1603</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">184</td>
<td>2015</td>
<td>5</td>
<td>2999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">185</td>
<td>2015</td>
<td>6</td>
<td>3301</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
</tr>
</tbody>
</table>

<p>187 rows × 3 columns</p>
</div>
</div>
</div>
<section id="regular-assign-call-1" class="level3" data-number="18.5.1">
<h3 data-number="18.5.1" class="anchored" data-anchor-id="regular-assign-call-1"><span class="header-section-number">18.5.1</span> Regular <code>assign()</code> Call</h3>
<p>Let’s add a column with the mean sales for the entire dataset, then calculate the difference between each month’s sales and the mean sales:</p>
<div id="d1cd2ff9" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>housing.assign(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    mean_sales<span class="op">=</span><span class="kw">lambda</span> x: x.sales.mean(), </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    sales_diff<span class="op">=</span><span class="kw">lambda</span> x: x.sales <span class="op">-</span> x.mean_sales</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">mean_sales</th>
<th data-quarto-table-cell-role="th">sales_diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>1</td>
<td>1025</td>
<td>1996.68984</td>
<td>-971.68984</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>2</td>
<td>1277</td>
<td>1996.68984</td>
<td>-719.68984</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>3</td>
<td>1603</td>
<td>1996.68984</td>
<td>-393.68984</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">184</td>
<td>2015</td>
<td>5</td>
<td>2999</td>
<td>1996.68984</td>
<td>1002.31016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">185</td>
<td>2015</td>
<td>6</td>
<td>3301</td>
<td>1996.68984</td>
<td>1304.31016</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
<td>1996.68984</td>
<td>1469.31016</td>
</tr>
</tbody>
</table>

<p>187 rows × 5 columns</p>
</div>
</div>
</div>
<p>In this example, the <code>mean_sales</code> column contains the mean sales value for the entire dataset, repeated in each row. The <code>sales_diff</code> column shows the difference between each month’s sales and the overall mean sales.</p>
</section>
<section id="grouped-assign-call-1" class="level3" data-number="18.5.2">
<h3 data-number="18.5.2" class="anchored" data-anchor-id="grouped-assign-call-1"><span class="header-section-number">18.5.2</span> Grouped <code>assign()</code> Call</h3>
<p>Now, let’s add a column with the mean sales for each year, and then calculate the difference between each month’s sales and the mean sales for that year:</p>
<div id="bc23ca00" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>housing.assign(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    mean_sales<span class="op">=</span><span class="kw">lambda</span> x: x.groupby(<span class="st">"year"</span>).sales.transform(<span class="st">"mean"</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    sales_diff<span class="op">=</span><span class="kw">lambda</span> x: x.sales <span class="op">-</span> x.mean_sales</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">mean_sales</th>
<th data-quarto-table-cell-role="th">sales_diff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>1</td>
<td>1025</td>
<td>1551.750000</td>
<td>-526.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>2</td>
<td>1277</td>
<td>1551.750000</td>
<td>-274.750000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>3</td>
<td>1603</td>
<td>1551.750000</td>
<td>51.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">184</td>
<td>2015</td>
<td>5</td>
<td>2999</td>
<td>2696.857143</td>
<td>302.142857</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">185</td>
<td>2015</td>
<td>6</td>
<td>3301</td>
<td>2696.857143</td>
<td>604.142857</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
<td>2696.857143</td>
<td>769.142857</td>
</tr>
</tbody>
</table>

<p>187 rows × 5 columns</p>
</div>
</div>
</div>
<p>Here’s what’s happening: - Within the <code>assign()</code> method, we group by year and use <code>transform("mean")</code> to compute the mean sales for each year. - The <code>mean_sales</code> column now contains the mean sales for each year, repeated in each row of that year. - The <code>sales_diff</code> column shows how far each month’s sales are from the mean sales for that year, allowing us to see which months are high and low performers within each year.</p>
<p>This grouped approach allows us to compare sales within each year, accounting for overall trends or differences between years.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-compute-mean-temperature-for-each-day" class="level3 callout-body-container callout-body" data-number="18.5.3">
<h3 data-number="18.5.3" class="anchored" data-anchor-id="practice-q-compute-mean-temperature-for-each-day"><span class="header-section-number">18.5.3</span> Practice Q: Compute Mean Temperature for Each Day</h3>
<p>With the <code>gibraltar</code> dataframe, group by the date of measurement, then in a new variable called <code>mean_temp</code>, compute the mean temperature for each day. Store the result in a new dataframe called <code>mean_temp_question</code>.</p>
<div id="1bca3af6" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Complete the code with your answer:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>mean_temp_question <span class="op">=</span> gibraltar.assign(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    mean_temp<span class="op">=</span>___________________________________<span class="op">-</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>mean_temp_question</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</section>
<section id="more-examples-of-grouped-transformations" class="level3" data-number="18.5.4">
<h3 data-number="18.5.4" class="anchored" data-anchor-id="more-examples-of-grouped-transformations"><span class="header-section-number">18.5.4</span> More Examples of Grouped Transformations</h3>
<section id="rank-sales-within-each-year" class="level4" data-number="18.5.4.1">
<h4 data-number="18.5.4.1" class="anchored" data-anchor-id="rank-sales-within-each-year"><span class="header-section-number">18.5.4.1</span> Rank Sales Within Each Year</h4>
<p>Now let’s look at another example. We can add a column that ranks the sales volume for each year.</p>
<div id="c3d2ffc4" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>housing.assign(sales_rank<span class="op">=</span>housing.groupby(<span class="st">"year"</span>).sales.rank(ascending<span class="op">=</span><span class="va">False</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">sales_rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>1</td>
<td>1025</td>
<td>12.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>2</td>
<td>1277</td>
<td>10.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>3</td>
<td>1603</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">184</td>
<td>2015</td>
<td>5</td>
<td>2999</td>
<td>3.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">185</td>
<td>2015</td>
<td>6</td>
<td>3301</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
<td>1.0</td>
</tr>
</tbody>
</table>

<p>187 rows × 4 columns</p>
</div>
</div>
</div>
<p>In this example, we’re creating a new column <code>sales_rank</code> that ranks the <code>sales</code> column in descending order within each year group. This allows us to see which months had the highest sales for each year.</p>
<p>These examples demonstrate how we can use grouped operations to perform more nuanced analyses on our data, allowing us to uncover patterns and insights within specific subgroups of our dataset.</p>
</section>
<section id="cumulative-sales-column" class="level4" data-number="18.5.4.2">
<h4 data-number="18.5.4.2" class="anchored" data-anchor-id="cumulative-sales-column"><span class="header-section-number">18.5.4.2</span> Cumulative Sales Column</h4>
<p>Let’s add a column that shows the cumulative sales for each year, adding up the sales for each month within the year.</p>
<div id="f7b84f48" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>housing.assign(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    cumulative_sales<span class="op">=</span>housing.groupby(<span class="st">"year"</span>).sales.transform(<span class="st">"cumsum"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">cumulative_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>1</td>
<td>1025</td>
<td>1025</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>2</td>
<td>1277</td>
<td>2302</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>3</td>
<td>1603</td>
<td>3905</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">184</td>
<td>2015</td>
<td>5</td>
<td>2999</td>
<td>12111</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">185</td>
<td>2015</td>
<td>6</td>
<td>3301</td>
<td>15412</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
<td>18878</td>
</tr>
</tbody>
</table>

<p>187 rows × 4 columns</p>
</div>
</div>
</div>
</section>
<section id="percent-of-yearly-sales-done-each-month" class="level4" data-number="18.5.4.3">
<h4 data-number="18.5.4.3" class="anchored"><span class="header-section-number">18.5.4.3</span> Percent of Yearly Sales Done Each Month</h4>
<p>We can calculate the percent of sales done each month for that year.</p>
<div id="90d2b943" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>housing.assign(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    percent_sales<span class="op">=</span><span class="kw">lambda</span> x: <span class="dv">100</span> <span class="op">*</span> x.sales <span class="op">/</span> x.groupby(<span class="st">"year"</span>).sales.transform(<span class="st">"sum"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">percent_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000</td>
<td>1</td>
<td>1025</td>
<td>5.504538</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000</td>
<td>2</td>
<td>1277</td>
<td>6.857849</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000</td>
<td>3</td>
<td>1603</td>
<td>8.608560</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">184</td>
<td>2015</td>
<td>5</td>
<td>2999</td>
<td>15.886217</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">185</td>
<td>2015</td>
<td>6</td>
<td>3301</td>
<td>17.485962</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
<td>18.359996</td>
</tr>
</tbody>
</table>

<p>187 rows × 4 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-cumulative-listings-column" class="level3 callout-body-container callout-body" data-number="18.5.5">
<h3 data-number="18.5.5" class="anchored" data-anchor-id="practice-q-cumulative-listings-column"><span class="header-section-number">18.5.5</span> Practice Q: Cumulative Listings Column</h3>
<p>With the <code>housing</code> dataframe, group by <code>year</code>, then create a cumulative listings column for each year.</p>
<div id="edb38fcc" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</section>
</section>
</section>
<section id="grouped-filtering-with-query" class="level2" data-number="18.6">
<h2 data-number="18.6" class="anchored" data-anchor-id="grouped-filtering-with-query"><span class="header-section-number">18.6</span> Grouped Filtering with <code>query()</code></h2>
<p>To query per group, it is usually better to create a relevant column with <code>groupby()</code> and <code>transform()</code>, then use <code>query()</code> on the resulting dataframe to filter data.</p>
<section id="filter-for-month-with-highest-sales-volume-per-year" class="level3" data-number="18.6.1">
<h3 data-number="18.6.1" class="anchored" data-anchor-id="filter-for-month-with-highest-sales-volume-per-year"><span class="header-section-number">18.6.1</span> Filter for Month with Highest Sales Volume per Year</h3>
<p>For example, if we want to filter the data for the month with the highest sales volume per year group (the month with the highest sales volume for each year), we can use <code>groupby()</code> with <code>transform()</code> to first create a column with the max sales volume per year, then ungroup and filter.</p>
<div id="98889bc9" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>housing</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  .assign(max_sales<span class="op">=</span>housing.groupby(<span class="st">"year"</span>).sales.transform(<span class="st">"max"</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  .query(<span class="st">"sales == max_sales"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">max_sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>5</td>
<td>1980</td>
<td>1980</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>2001</td>
<td>7</td>
<td>1871</td>
<td>1871</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>2002</td>
<td>5</td>
<td>1931</td>
<td>1931</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">162</td>
<td>2013</td>
<td>7</td>
<td>3376</td>
<td>3376</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">173</td>
<td>2014</td>
<td>6</td>
<td>3195</td>
<td>3195</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
<td>3466</td>
</tr>
</tbody>
</table>

<p>16 rows × 4 columns</p>
</div>
</div>
</div>
<p>We can drop the <code>max_sales</code> column if we want to at the end.</p>
<div id="702ca8ea" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>housing</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  .assign(max_sales<span class="op">=</span>housing.groupby(<span class="st">"year"</span>).sales.transform(<span class="st">"max"</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  .query(<span class="st">"sales == max_sales"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  .drop(columns<span class="op">=</span>[<span class="st">"max_sales"</span>])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000</td>
<td>5</td>
<td>1980</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>2001</td>
<td>7</td>
<td>1871</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>2002</td>
<td>5</td>
<td>1931</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">162</td>
<td>2013</td>
<td>7</td>
<td>3376</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">173</td>
<td>2014</td>
<td>6</td>
<td>3195</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">186</td>
<td>2015</td>
<td>7</td>
<td>3466</td>
</tr>
</tbody>
</table>

<p>16 rows × 3 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-filter-for-time-of-day-with-highest-wind-speed" class="level3 callout-body-container callout-body" data-number="18.6.2">
<h3 data-number="18.6.2" class="anchored" data-anchor-id="practice-q-filter-for-time-of-day-with-highest-wind-speed"><span class="header-section-number">18.6.2</span> Practice Q: Filter for Time of Day with Highest Wind Speed</h3>
<p>With the <code>gibraltar</code> dataframe created above, group by the date of measurement, calculate the time of day with the highest recorded wind speed <code>wind_speed</code> for each day, then filter the dataframe to keep only the rows with the highest wind speed for each day.</p>
<p>Note that for some days, there may be a tie in the highest wind speed.</p>
<div id="a77e9fb0" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</section>
<section id="month-with-the-most-typical-sales" class="level3" data-number="18.6.3">
<h3 data-number="18.6.3" class="anchored" data-anchor-id="month-with-the-most-typical-sales"><span class="header-section-number">18.6.3</span> Month with the Most “Typical” Sales</h3>
<p>We can also use <code>groupby()</code> with <code>transform()</code> to find the month with the most “typical” sales. We’ll use the mean sales volume for each year as the “typical” sales volume, then get the month with the closest sales to that.</p>
<div id="fca0e28e" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>housing</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  .assign(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    mean_sales<span class="op">=</span>housing.groupby(<span class="st">"year"</span>).sales.transform(<span class="st">"mean"</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    sales_diff_abs<span class="op">=</span><span class="kw">lambda</span> x: (x.sales <span class="op">-</span> x.mean_sales).<span class="bu">abs</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  .sort_values(<span class="st">"sales_diff_abs"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  .groupby(<span class="st">"year"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  .first()</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">sales</th>
<th data-quarto-table-cell-role="th">mean_sales</th>
<th data-quarto-table-cell-role="th">sales_diff_abs</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2000</td>
<td>4</td>
<td>1556</td>
<td>1551.750000</td>
<td>4.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2001</td>
<td>3</td>
<td>1553</td>
<td>1532.666667</td>
<td>20.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2002</td>
<td>3</td>
<td>1550</td>
<td>1559.666667</td>
<td>9.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2013</td>
<td>9</td>
<td>2544</td>
<td>2536.333333</td>
<td>7.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2014</td>
<td>10</td>
<td>2588</td>
<td>2579.416667</td>
<td>8.583333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2015</td>
<td>3</td>
<td>2677</td>
<td>2696.857143</td>
<td>19.857143</td>
</tr>
</tbody>
</table>

<p>16 rows × 4 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-filter-for-times-with-above-mean-temperature" class="level3 callout-body-container callout-body" data-number="18.6.4">
<h3 data-number="18.6.4" class="anchored" data-anchor-id="practice-q-filter-for-times-with-above-mean-temperature"><span class="header-section-number">18.6.4</span> Practice Q: Filter for Times with Above Mean Temperature</h3>
<p>Group the <code>gibraltar</code> dataframe by <code>date</code>, then use <code>apply()</code>, <code>assign()</code>, and <code>query()</code> as needed to subset to only times when the temperature is above the mean temperature for that day. You should have 698 rows in the output.</p>
<div id="f3f7b279" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</section>
</section>
<section id="wrap-up" class="level2" data-number="18.7">
<h2 data-number="18.7" class="anchored" data-anchor-id="wrap-up"><span class="header-section-number">18.7</span> Wrap Up</h2>
<p>In this lesson, we explored powerful techniques for grouped operations in pandas:</p>
<ol type="1">
<li>Using <code>groupby()</code> with <code>transform()</code> and <code>assign()</code> for grouped transformations</li>
<li>Combining <code>groupby()</code>, <code>transform()</code>, and <code>query()</code> for grouped filtering</li>
</ol>
<p>These methods significantly enhance our ability to analyze and manipulate data within specific groups.</p>
<p>Congratulations on making it through!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./p_untangled_groupby_agg.html" class="pagination-link" aria-label="Grouping and summarizing data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Grouping and summarizing data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./p_untangled_pivoting.html" class="pagination-link" aria-label="Reshaping data">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Reshaping data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Book created by <a href="https://thegraphcourses.org/">The GRAPH Courses</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/the-graph-courses/idap_book/edit/main/p_untangled_other_grouped_operations.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/the-graph-courses/idap_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>TEMPORARY For a PDF copy, please visit this <a href="https://raw.githubusercontent.com/the-graph-courses/idar_book/main/pdf/Introduction-to-Data-Analysis-with-R.pdf">page</a>.</p>
</div>
  </div>
</footer>




</body></html>