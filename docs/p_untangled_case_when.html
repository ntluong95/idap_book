<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>16&nbsp; Conditional assignment with case_when() and np.where() – Introduction to Data Science with Python</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./p_untangled_groupby_agg.html" rel="next">
<link href="./p_untangled_assign.html" rel="prev">
<link href="./logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p_untangled_subset_columns.html">Data Manipulation</a></li><li class="breadcrumb-item"><a href="./p_untangled_case_when.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Conditional assignment with case_when() and np.where()</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Science with Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/the-graph-courses/idap_book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_google_colab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Google Colab</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_coding_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coding basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_functions_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Functions, Methods, and Libraries in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_data_structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Structures in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_foundations_for_loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Intro to Loops in Python</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Visualization</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_data_viz_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Visualization Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_univariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Univariate Graphs with Plotly Express</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_data_on_display_multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Bivariate &amp; Multivariate Graphs with Plotly Express</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Tools for Local Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_installing_python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Installing Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_using_vscode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Installing and Using VS Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_venv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Folders and Virtual Environments</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_tools_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Using Quarto</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Manipulation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_subset_columns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Subsetting columns</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_query_rows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Subsetting rows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_assign.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Creating and modifying variables with <code>assign()</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_case_when.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Conditional assignment with case_when() and np.where()</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_groupby_agg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Grouping and summarizing data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_other_grouped_operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Grouped Transformations and Filtering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./p_untangled_pivoting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Reshaping data</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">16.1</span> Introduction</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">16.2</span> Learning objectives</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages"><span class="header-section-number">16.3</span> Packages</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets"><span class="header-section-number">16.4</span> Datasets</a></li>
  <li><a href="#introduction-to-case_when" id="toc-introduction-to-case_when" class="nav-link" data-scroll-target="#introduction-to-case_when"><span class="header-section-number">16.5</span> Introduction to <code>case_when()</code></a></li>
  <li><a href="#a-catch-all-condition" id="toc-a-catch-all-condition" class="nav-link" data-scroll-target="#a-catch-all-condition"><span class="header-section-number">16.7</span> A catch-all condition</a></li>
  <li><a href="#counting-counties-by-name-characteristics" id="toc-counting-counties-by-name-characteristics" class="nav-link" data-scroll-target="#counting-counties-by-name-characteristics"><span class="header-section-number">16.8</span> Counting counties by name characteristics</a></li>
  <li><a href="#matching-nans-with-isna" id="toc-matching-nans-with-isna" class="nav-link" data-scroll-target="#matching-nans-with-isna"><span class="header-section-number">16.9</span> Matching NaN’s with <code>isna()</code></a></li>
  <li><a href="#binary-conditions-np.where" id="toc-binary-conditions-np.where" class="nav-link" data-scroll-target="#binary-conditions-np.where"><span class="header-section-number">16.10</span> Binary conditions: <code>np.where()</code></a></li>
  <li><a href="#wrap-up" id="toc-wrap-up" class="nav-link" data-scroll-target="#wrap-up"><span class="header-section-number">16.11</span> Wrap up</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/the-graph-courses/idap_book/edit/main/p_untangled_case_when.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/the-graph-courses/idap_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./p_untangled_subset_columns.html">Data Manipulation</a></li><li class="breadcrumb-item"><a href="./p_untangled_case_when.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Conditional assignment with case_when() and np.where()</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Conditional assignment with case_when() and np.where()</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">16.1</span> Introduction</h2>
<p>In the previous lesson, you learned the basics of data transformation using pandas’ <code>assign()</code> method.</p>
<p>In that lesson, we looked at <em>global</em> transformations; that is, transformations that did the same thing to an entire variable. In this lesson, we will look at how to <em>conditionally</em> manipulate certain rows based on whether or not they meet defined criteria.</p>
<p>For this, we will mostly use the powerful pandas<code>case_when()</code> method. Note that this was introduced recently, in pandas 2.2, so if you are using an older version of pandas, you will need to upgrade.</p>
<p>Let’s get started.</p>
</section>
<section id="learning-objectives" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">16.2</span> Learning objectives</h2>
<ol type="1">
<li><p>You can transform or create new variables based on conditions using <code>case_when()</code></p></li>
<li><p>You know how to use a default condition in <code>case_when()</code> to match unmatched cases.</p></li>
<li><p>You can handle <code>NaN</code> values in <code>case_when()</code> transformations.</p></li>
<li><p>You understand <code>case_when()</code> conditions priority order.</p></li>
<li><p>You can use <code>np.where()</code> for binary conditional assignment.</p></li>
</ol>
</section>
<section id="packages" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="packages"><span class="header-section-number">16.3</span> Packages</h2>
<p>This lesson will require pandas and numpy:</p>
<div id="a440a321" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="datasets" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="datasets"><span class="header-section-number">16.4</span> Datasets</h2>
<p>In this lesson, we will use a dataset of counties of the United States with demographic and economic data.</p>
<p>Below we import it, then add some NAs to the <code>pop_20</code> column, to simulate missing data.</p>
<div id="8bf4dd5d" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import and view the dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>counties <span class="op">=</span> pd.read_csv(<span class="st">"data/us_counties_data.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add NAs to the population column</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>counties.loc[counties.index <span class="op">%</span> <span class="dv">5</span> <span class="op">==</span> <span class="dv">0</span>, <span class="st">"pop_20"</span>] <span class="op">=</span> np.nan</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>counties</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">pop_20</th>
<th data-quarto-table-cell-role="th">area_sq_miles</th>
<th data-quarto-table-cell-role="th">hh_inc_21</th>
<th data-quarto-table-cell-role="th">econ_type</th>
<th data-quarto-table-cell-role="th">unemp_20</th>
<th data-quarto-table-cell-role="th">foreign_born_num</th>
<th data-quarto-table-cell-role="th">pop_change_2010_2020</th>
<th data-quarto-table-cell-role="th">pct_emp_change_2010_2021</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>AL</td>
<td>Autauga, AL</td>
<td>NaN</td>
<td>594.456107</td>
<td>66444.0</td>
<td>Nonspecialized</td>
<td>5.4</td>
<td>1241.0</td>
<td>7.758700</td>
<td>9.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>AL</td>
<td>Baldwin, AL</td>
<td>233140.0</td>
<td>1589.836014</td>
<td>65658.0</td>
<td>Recreation</td>
<td>6.2</td>
<td>7938.0</td>
<td>27.159356</td>
<td>28.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>AL</td>
<td>Barbour, AL</td>
<td>25180.0</td>
<td>885.008019</td>
<td>38649.0</td>
<td>Manufacturing</td>
<td>7.8</td>
<td>659.0</td>
<td>-8.136359</td>
<td>-13.9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>PR</td>
<td>Villalba, PR</td>
<td>22044.0</td>
<td>35.636678</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-15.264833</td>
<td>-1.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>PR</td>
<td>Yabucoa, PR</td>
<td>30364.0</td>
<td>55.214614</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-19.807069</td>
<td>0.1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>PR</td>
<td>Yauco, PR</td>
<td>NaN</td>
<td>67.711484</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>-18.721309</td>
<td>-5.3</td>
</tr>
</tbody>
</table>

<p>3226 rows × 10 columns</p>
</div>
</div>
</div>
<p>The variables in the dataset are:</p>
<ul>
<li><code>state</code>, US state</li>
<li><code>county</code>, US county</li>
<li><code>pop_20</code>, population estimate for 2020</li>
<li><code>area_sq_miles</code>, area in square miles</li>
<li><code>hh_inc_21</code>, median household income for 2021</li>
<li><code>econ_type</code>, economic type of the county</li>
<li><code>pop_change_2010_2020</code>, population change between 2010 and 2020</li>
<li><code>unemp_20</code>, unemployment rate for 2020</li>
<li><code>pct_emp_change_2010_2021</code>, percentage change in employment between 2010 and 2021</li>
</ul>
<p>The variables are collected from a range of sources, including the US Census Bureau, the Bureau of Labor Statistics, and the American Community Survey.</p>
<p>Let’s also make some subsets of the data to work with.</p>
<div id="04f9deda" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>counties_pop <span class="op">=</span> counties[[<span class="st">"pop_20"</span>]]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>counties_income <span class="op">=</span> counties[[<span class="st">"hh_inc_21"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction-to-case_when" class="level2" data-number="16.5">
<h2 data-number="16.5" class="anchored" data-anchor-id="introduction-to-case_when"><span class="header-section-number">16.5</span> Introduction to <code>case_when()</code></h2>
<p>To get familiar with <code>case_when()</code>, let’s begin with a simple conditional transformation on the <code>pop_20</code> column of the <code>counties</code> dataset.</p>
<p>We will make a new column, called “pop_class”, that has the value “Smaller” if the population is below 50,000, and “Larger” if the population is 50,000 or more.</p>
<div id="f14280a4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>counties_pop <span class="op">=</span> counties_pop.assign(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    pop_class<span class="op">=</span><span class="kw">lambda</span> x: x.pop_20.case_when(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">&lt;</span> <span class="dv">50000</span>, <span class="st">"Smaller"</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">&gt;=</span> <span class="dv">50000</span>, <span class="st">"Larger"</span>),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>counties_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop_20</th>
<th data-quarto-table-cell-role="th">pop_class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>233140.0</td>
<td>Larger</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25180.0</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>22044.0</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>30364.0</td>
<td>Smaller</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>3226 rows × 2 columns</p>
</div>
</div>
</div>
<p>The statement <code>case_when([(x.pop_20 &lt; 50000, "Smaller"), (x.pop_20 &gt;= 50000, "Larger")])</code> can be read as: “if <code>pop_20</code> is below 50,000, input ‘Smaller’, else if <code>pop_20</code> is greater than or equal to 50,000, input ‘Larger’”.</p>
<p>The <code>case_when()</code> syntax may seem a bit foreign. So let’s break it down:</p>
<ul>
<li>First, we use the <code>assign()</code> method to create a new column, <code>pop_class</code>.</li>
<li>Then we use a lambda function to define the <code>pop_class</code> column. Hopefullyou you recall how to write these.</li>
<li>Then, we use the <code>case_when()</code> method to create the new column.</li>
<li>Inside the <code>case_when()</code> method, we use a list of tuples.</li>
<li>Recall that lists are created with square brackets <code>[]</code>.</li>
<li>Tuples are created with parentheses <code>(itemA, itemB)</code>, with each element in the tuple separated by a comma.</li>
<li>So the list of tuples is <code>[(conditionA, valueA), (conditionB, valueB)]</code>.</li>
</ul>
<hr>
<p>After creating a new variable with <code>case_when()</code>, you shoul inspect it to make sure the transformation worked as intended.</p>
<p>Let’s use the <code>value_counts()</code> method to ensure that the numbers and proportions “make sense”:</p>
<div id="aec2ee6c" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>counties_pop[<span class="st">"pop_class"</span>].value_counts() <span class="co"># numbers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>pop_class
Smaller    1773
Larger      801
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="073010eb" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>counties_pop[<span class="st">"pop_class"</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>) <span class="co"># proportions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>pop_class
Smaller    0.688811
Larger     0.311189
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<p>Do these seem reasonable based on the population size of US counties? (Yes!)</p>
<p>Let’s make it a bit more complex with a third condition for medium-sized counties. Counties with populations from 30,000 to below 100,000 will be labeled “Medium”, and counties with populations of 100,000 and up will be labeled “Large”.</p>
<div id="6e081417" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>counties_pop <span class="op">=</span> counties_pop.assign(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    pop_class<span class="op">=</span><span class="kw">lambda</span> x: x.pop_20.case_when(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">&lt;</span> <span class="dv">30000</span>, <span class="st">"Small"</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            ((x.pop_20 <span class="op">&gt;=</span> <span class="dv">30000</span>) <span class="op">&amp;</span> (x.pop_20 <span class="op">&lt;</span> <span class="dv">100000</span>), <span class="st">"Medium"</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">&gt;=</span> <span class="dv">100000</span>, <span class="st">"Large"</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>counties_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop_20</th>
<th data-quarto-table-cell-role="th">pop_class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>233140.0</td>
<td>Large</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25180.0</td>
<td>Small</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>22044.0</td>
<td>Small</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>30364.0</td>
<td>Medium</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>3226 rows × 2 columns</p>
</div>
</div>
</div>
<p>Note that when we combine multiple conditions with <code>&amp;</code>, we must use parentheses around each condition.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-recode-income-class" class="level3 callout-body-container callout-body" data-number="16.5.1">
<h3 data-number="16.5.1" class="anchored" data-anchor-id="practice-q-recode-income-class"><span class="header-section-number">16.5.1</span> Practice Q: Recode income class</h3>
<p>The <code>counties_income</code> dataset has a column called <code>hh_inc_21</code> with the median household income in 2021. Make a new column, called <code>income_group</code>, with the following three groups:</p>
<ul>
<li>“Below 30k” for counties with income under $30,000</li>
<li>“30k to 60k” for counties with income between $30,000 and $60,000 (exclusive of 60k)</li>
<li>“60k and above” for counties with income of $60,000 and up</li>
</ul>
<div id="7c7237a3" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code with your answer:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Q_income_group <span class="op">=</span> counties_income.assign(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    income_group<span class="op">=</span><span class="kw">lambda</span> x: x.hh_inc_21.case_when(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>            (x.hh_inc_21 <span class="op">&lt;</span> <span class="dv">30000</span>, <span class="st">"Below 30k"</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>            _________________________________</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            _________________________________</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>Q_income_group[<span class="st">"income_group"</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use the <code>value_counts()</code> method to count the proportions of each income group. If you did it correctly, the proportion of counties with median household income below $60,000 should be approximately 60%.</li>
</ul>
</section>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Pro-tip">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Pro-tip
</div>
</div>
<section id="denoting-intervals" class="level2 callout-body-container callout-body" data-number="16.6">
<h2 data-number="16.6" class="anchored" data-anchor-id="denoting-intervals"><span class="header-section-number">16.6</span> Denoting intervals</h2>
<p>When categorizing variables, it’s important to clearly communicate whether each category includes or excludes its boundaries. Here are two common approaches:</p>
<ol type="1">
<li>Mathematical notation:
<ul>
<li>Use square brackets <code>[]</code> for inclusive bounds and parentheses <code>()</code> for exclusive bounds.</li>
<li>Example:
<ul>
<li>[0, 60,000) : This means under $60,000</li>
<li>[60,000, 100,000) : This means $60,000 to $99,999</li>
<li>[100,000, ∞) : This means $100,000 and up. The ∞ symbol stands for infinity.</li>
</ul></li>
</ul></li>
<li>Code-friendly notation:
<ul>
<li>Use <code>&gt;=</code> and <code>&lt;=</code> for inclusive bounds.</li>
<li>Use <code>&gt;</code> and <code>&lt;</code> for exclusive bounds.</li>
<li>Example:
<ul>
<li>x &lt; $60,000 : This means under $60,000</li>
<li>$60,000 &lt; x &lt; $100,000 : This means $60,000 to $99,999.99…</li>
<li>x &gt;= $100,000 : This means $100,000 and up</li>
</ul></li>
</ul></li>
<li>Rounded integer ranges (more reader-friendly):
<ul>
<li>Round values to integers and use descriptive language.</li>
<li>Example:
<ul>
<li>$0 to $59,999</li>
<li>$60,000 to $99,999</li>
<li>$100,000 and up</li>
</ul></li>
</ul></li>
</ol>
<p>Choose the method that best suits your audience and context.</p>
</section>
</div>
</section>
<section id="a-catch-all-condition" class="level2" data-number="16.7">
<h2 data-number="16.7" class="anchored" data-anchor-id="a-catch-all-condition"><span class="header-section-number">16.7</span> A catch-all condition</h2>
<p>In a <code>case_when()</code> statement, you sometimes want to catch all rows not matched with provided conditions. You can do this with a catch-all condition. This should be something that always returns <code>True</code>. Unfortunately, simply using <code>True</code> as the condition will not work, since we need a <strong>sequence</strong> of True values.</p>
<p>You could use <code>pd.Series(True, index=df.index)</code> to create a sequence of <code>True</code> values, but perhaps an easier solution is to test whether the values are equal to themselves, using, for example <code>x.pop_20 == x.pop_20</code>:</p>
<div id="35904504" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>counties_pop <span class="op">=</span> counties_pop.assign(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    pop_class<span class="op">=</span><span class="kw">lambda</span> x: x.pop_20.case_when(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            ((x.pop_20 <span class="op">&gt;=</span> <span class="dv">30000</span>) <span class="op">&amp;</span> (x.pop_20 <span class="op">&lt;</span> <span class="dv">100000</span>), <span class="st">"Medium"</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">==</span> x.pop_20, <span class="st">"Other"</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>counties_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop_20</th>
<th data-quarto-table-cell-role="th">pop_class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>233140.0</td>
<td>Other</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25180.0</td>
<td>Other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>22044.0</td>
<td>Other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>30364.0</td>
<td>Medium</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>3226 rows × 2 columns</p>
</div>
</div>
</div>
<p>This <code>x.pop_20 == x.pop_20</code> condition can be read as “for everything else…”.</p>
<div class="callout callout-style-default callout-caution callout-titled" title="Watch Out">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Watch Out
</div>
</div>
<section id="order-of-conditions" class="level3 callout-body-container callout-body" data-number="16.7.1">
<h3 data-number="16.7.1" class="anchored" data-anchor-id="order-of-conditions"><span class="header-section-number">16.7.1</span> Order of conditions</h3>
<p>It is important to use <code>x.pop_20 == x.pop_20</code> as the <em>final</em> condition in <code>case_when()</code>. If you use it as the first condition, it will take precedence over all others, as seen here:</p>
<div id="d8807658" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>counties_pop <span class="op">=</span> counties_pop.assign(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    pop_class<span class="op">=</span><span class="kw">lambda</span> x: x.pop_20.case_when(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">==</span> x.pop_20, <span class="st">"Other"</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            ((x.pop_20 <span class="op">&gt;=</span> <span class="dv">30000</span>) <span class="op">&amp;</span> (x.pop_20 <span class="op">&lt;</span> <span class="dv">100000</span>), <span class="st">"Medium"</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>counties_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop_20</th>
<th data-quarto-table-cell-role="th">pop_class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>233140.0</td>
<td>Other</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25180.0</td>
<td>Other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>22044.0</td>
<td>Other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>30364.0</td>
<td>Other</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>3226 rows × 2 columns</p>
</div>
</div>
</div>
<p>As you can observe, all non-NaN counties are now coded with “Other”, because the <code>x.pop_20 == x.pop_20</code> condition was placed first, and therefore took precedence.</p>
<p>Statements with case_when are evaluated from top to bottom, so conditions that should be evaluated first should be placed higher in the list.</p>
</section>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-recode-income-class-2" class="level3 callout-body-container callout-body" data-number="16.7.2">
<h3 data-number="16.7.2" class="anchored" data-anchor-id="practice-q-recode-income-class-2"><span class="header-section-number">16.7.2</span> Practice Q: Recode income class 2</h3>
<p>Using the <code>counties_income</code> data, and the <code>hh_inc_21</code> column, create a new column called <code>income_class</code> that has the value “Medium income” for counties with median household income from $60,000 to below $100,000 and “Other” for all other counties. (Use a catch-all condition.) Your new dataframe should be called <code>Q_income_class</code>.</p>
<div id="628b27c9" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</section>
<section id="counting-counties-by-name-characteristics" class="level2" data-number="16.8">
<h2 data-number="16.8" class="anchored" data-anchor-id="counting-counties-by-name-characteristics"><span class="header-section-number">16.8</span> Counting counties by name characteristics</h2>
<p>To get more practice with <code>case_when()</code>, let’s explore a fun application of it by analyzing county names.</p>
<p>We’ll look for counties that have the words “River” or “Rio” (spanish for river) in their names. This may be interesting to know, as these often indicate counties with significant water features.</p>
<p>First, we’ll use <code>case_when()</code> to create a new column that flags these counties:</p>
<div id="c4ce85f2" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>counties_names <span class="op">=</span> counties[[<span class="st">"county"</span>]]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>counties_names <span class="op">=</span> counties_names.assign(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    water_name<span class="op">=</span><span class="kw">lambda</span> x: x.county.case_when(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            (x.county.<span class="bu">str</span>.contains(<span class="st">"River|Rio"</span>), <span class="st">"River in name"</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            (x.county <span class="op">==</span> x.county, <span class="st">"Other"</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>counties_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">water_name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Autauga, AL</td>
<td>Other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Baldwin, AL</td>
<td>Other</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Barbour, AL</td>
<td>Other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>Villalba, PR</td>
<td>Other</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>Yabucoa, PR</td>
<td>Other</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>Yauco, PR</td>
<td>Other</td>
</tr>
</tbody>
</table>

<p>3226 rows × 2 columns</p>
</div>
</div>
</div>
<p>In this code, we’re using a regular expression <code>"River|Rio"</code> to match either “River” or “Rio” in the county name. The <code>|</code> symbol in regex means “or”. We’re also using our catch-all condition <code>x.county == x.county</code> to label all other counties as “Other”.</p>
<p>Let’s see how many counties we’ve identified:</p>
<div id="3df8e745" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>counties_names[<span class="st">"water_name"</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>water_name
Other            0.99597
River in name    0.00403
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<p>Interesting! It looks like about X% of counties have “River” or “Rio” in their name.</p>
<p>Now, let’s use <code>.query()</code> to keep just those water-related counties:</p>
<div id="f53c2bbe" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>water_counties <span class="op">=</span> counties_names.query(<span class="st">"water_name == 'Water in name'"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>water_counties</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">water_name</th>
</tr>
</thead>
<tbody>
</tbody>
</table>

</div>
</div>
</div>
<p>Cool! Do you recognize any of these counties?</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-find-lake-or-bay-counties" class="level3 callout-body-container callout-body" data-number="16.8.1">
<h3 data-number="16.8.1" class="anchored" data-anchor-id="practice-q-find-lake-or-bay-counties"><span class="header-section-number">16.8.1</span> Practice Q: Find lake or bay counties</h3>
<p>In a similar way to what we did with “River” or “Rio”, find counties with “Lake” or “Bay” in their names. Create a new column called <code>lake_bay_name</code> and then use <code>.query()</code> to create a dataframe called <code>lake_bay_counties</code> with only these counties.</p>
<p>Start with the <code>counties_names</code> dataframe.</p>
<div id="51a7ae60" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How does the proportion of “Lake” or “Bay” counties compare to “River” or “Rio” counties?</p>
</section>
</div>
<p>This example shows how we can use <code>case_when()</code> along with string methods and regular expressions to create meaningful categories based on text data. It’s a powerful way to explore patterns in your dataset!</p>
</section>
<section id="matching-nans-with-isna" class="level2" data-number="16.9">
<h2 data-number="16.9" class="anchored" data-anchor-id="matching-nans-with-isna"><span class="header-section-number">16.9</span> Matching NaN’s with <code>isna()</code></h2>
<p>As you may have noticed, the <code>pop_20</code> column contains <code>NaN</code> values, and these are not matched with any of the conditions we provided.</p>
<p>We can match missing values manually with <code>isna()</code>. Below we match <code>NaN</code> populations with <code>isna()</code> and set their population size to “Missing population”:</p>
<div id="a5348e0a" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>counties_pop <span class="op">=</span> counties_pop.assign(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    pop_class<span class="op">=</span><span class="kw">lambda</span> x: x.pop_20.case_when(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">&lt;</span> <span class="dv">50000</span>, <span class="st">"Smaller"</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            (x.pop_20 <span class="op">&gt;=</span> <span class="dv">50000</span>, <span class="st">"Larger"</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            (x.pop_20.isna(), <span class="st">"Missing"</span>),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>counties_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop_20</th>
<th data-quarto-table-cell-role="th">pop_class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>Missing</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>233140.0</td>
<td>Larger</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25180.0</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>22044.0</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>30364.0</td>
<td>Smaller</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>NaN</td>
<td>Missing</td>
</tr>
</tbody>
</table>

<p>3226 rows × 2 columns</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-recode-economic-type" class="level3 callout-body-container callout-body" data-number="16.9.1">
<h3 data-number="16.9.1" class="anchored" data-anchor-id="practice-q-recode-economic-type"><span class="header-section-number">16.9.1</span> Practice Q: Recode economic type</h3>
<p>The <code>econ_type</code> column of the <code>counties</code> dataset describes the primary economic activity of the county:</p>
<div id="15be011c" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>practice_econ <span class="op">=</span> counties[[<span class="st">"econ_type"</span>]]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>practice_econ.value_counts(dropna<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>econ_type               
Nonspecialized              1237
Manufacturing                501
Farming                      444
Federal/State Government     407
Recreation                   333
Mining                       221
NaN                           83
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Implement the following recoding, storing the new data in a column called <code>econ_type_recode</code>:</p>
<ul>
<li>Farming, Mining and Manufacturing to “Industry”</li>
<li>Federal/State Government to “Government”</li>
<li>Recreation and Nonspecialized to “Other”</li>
<li>NaNs to “Missing”</li>
</ul>
<p>To get you started, here is how to recode “Farming, Mining and Manufacturing” to “Industry”:</p>
<div id="2259cd46" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</section>
<section id="binary-conditions-np.where" class="level2" data-number="16.10">
<h2 data-number="16.10" class="anchored" data-anchor-id="binary-conditions-np.where"><span class="header-section-number">16.10</span> Binary conditions: <code>np.where()</code></h2>
<p>There is another function similar to <code>case_when()</code> for when we want to apply a binary condition to a variable: <code>np.where()</code>. A binary condition is either <code>True</code> or <code>False</code>.</p>
<p>Let’s test it out with a simple Series:</p>
<div id="28ecbaed" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0    1
1    2
2    3
3    4
4    5
dtype: int64</code></pre>
</div>
</div>
<div id="82d20bfe" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>np.where(x <span class="op">&gt;</span> <span class="dv">3</span>, <span class="st">"Above 3"</span>, <span class="st">"3 or below"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>array(['3 or below', '3 or below', '3 or below', 'Above 3', 'Above 3'],
      dtype='&lt;U10')</code></pre>
</div>
</div>
<p>As you can see, <code>np.where()</code> returns a new array with the values “Above 3” for all values greater than 3, and “3 or below” for all values less than or equal to 3.</p>
<p>This is useful when you want to make a quick modification to a variable, and don’t want to type up a whole <code>case_when()</code> statement.</p>
<p>Let’s try it out on our dataset to classify counties as “Larger” if their population is 50000 or more, and “Smaller” if their population is less than 50000.</p>
<div id="d180665f" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>counties_pop <span class="op">=</span> counties_pop.assign(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    pop_class<span class="op">=</span><span class="kw">lambda</span> x: np.where(x.pop_20 <span class="op">&gt;=</span> <span class="dv">50000</span>, <span class="st">"Larger"</span>, <span class="st">"Smaller"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>counties_pop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pop_20</th>
<th data-quarto-table-cell-role="th">pop_class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NaN</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>233140.0</td>
<td>Larger</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>25180.0</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3223</td>
<td>22044.0</td>
<td>Smaller</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3224</td>
<td>30364.0</td>
<td>Smaller</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3225</td>
<td>NaN</td>
<td>Smaller</td>
</tr>
</tbody>
</table>

<p>3226 rows × 2 columns</p>
</div>
</div>
</div>
<p>Nice and easy!</p>
<p>Since it is only a binary condition, it’s utility is limited, but it can be useful for quick transformations.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Practice">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Practice
</div>
</div>
<section id="practice-q-recode-income-class-with-np.where" class="level3 callout-body-container callout-body" data-number="16.10.1">
<h3 data-number="16.10.1" class="anchored" data-anchor-id="practice-q-recode-income-class-with-np.where"><span class="header-section-number">16.10.1</span> Practice Q: Recode income class with np.where()</h3>
<p>With the <code>counties_income</code> data, make a new column, called <code>income_class</code>, that has the value “Medium income” for counties with median household income between $60,000 and $100,000 (exclusive of 100k) and “Other” for all other counties. Use the <code>np.where()</code> function.</p>
<div id="6d2c5564" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the code with your answer:</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>Q_income_class <span class="op">=</span> counties_income.assign(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    income_class<span class="op">=</span><span class="kw">lambda</span> x: np.where(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Your code here</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</div>
</section>
<section id="wrap-up" class="level2" data-number="16.11">
<h2 data-number="16.11" class="anchored" data-anchor-id="wrap-up"><span class="header-section-number">16.11</span> Wrap up</h2>
<p>Changing or constructing your variables based on conditions on other variables is one of the most repeated data wrangling tasks.</p>
<p>I hope now that you will feel comfortable using <code>case_when()</code> and <code>np.where()</code> within <code>assign()</code>.</p>
<p>Soon we will learn more complex pandas operations such as grouping variables and summarizing them.</p>
<p>See you next time!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./p_untangled_assign.html" class="pagination-link" aria-label="Creating and modifying variables with `assign()`">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Creating and modifying variables with <code>assign()</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./p_untangled_groupby_agg.html" class="pagination-link" aria-label="Grouping and summarizing data">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Grouping and summarizing data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Book created by <a href="https://thegraphcourses.org/">The GRAPH Courses</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/the-graph-courses/idap_book/edit/main/p_untangled_case_when.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/the-graph-courses/idap_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>